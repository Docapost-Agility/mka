!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mka",[],t):"object"==typeof exports?exports.mka=t():e.mka=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var r=n(1),l=o(r),i=n(2),a=o(i),s=n(3),c=o(s),u=n(4),f=o(u),d=n(5),p=o(d),m=n(6),y=o(m),g=n(7),v=o(g),h=n(8),w=o(h),S=document.getElementById("mka");if(!S)throw new Error("mka id not found");var b={eltSelectableClass:"mka-elt",eltSelectedClass:"mka-elt-selected",onDragItemClass:null,dragNdrop:!0,rightClick:!1,lasso:!0,selectAllShortcut:!0,copyPaste:!0,arrows:!0,deleteShortcut:!0,count:"",dropFunction:function(e){console.log(e),console.log("Default drop function, think to implement this function")},pasteFunction:function(e){console.log(e),console.log("Default past function, think to implement this function")},deleteFunction:function(e){console.log(e),console.log("Default delete function, think to implement this function")}};b.actions=[];var E=[],x=[],k=[];HTMLElement.prototype.mkaInit=function(e){Object.keys(e).map(function(t){b[t]=e[t]}),E=[].slice.call(document.getElementsByClassName(b.eltSelectableClass)),S.style.userSelect="none",b.rightClick&&k.push(l),b.dragNdrop&&k.push(a),b.selectAllShortcut&&k.push(w),b.copyPaste&&k.push(f),b.deleteShortcut&&k.push(v),b.arrows&&k.push(y),b.count&&k.push(p),k.push(c);var t={getContainer:function(){return S},elementIsSelected:function(e){if(e.classList&&e.classList.contains(b.eltSelectedClass))return!0;for(;e.parentNode;)if(e=e.parentNode,e.classList&&e.classList.contains(b.eltSelectedClass))return!0;return!1},getSelectableElement:function(e){if(e.classList&&e.classList.contains(b.eltSelectableClass))return e;for(;e.parentNode;)if(e=e.parentNode,e.classList&&e.classList.contains(b.eltSelectableClass))return e;return null},getSelectablesElements:function(){return E},getLastSelectedInDom:function(){var e=null;return Array.from(x).map(function(t){(!e||t.offsetTop>e.offsetTop||t.offsetTop===e.offsetTop&&t.offsetLeft>e.offsetLeft)&&(e=t)}),e},getSelection:function(){var e=[];return Array.from(x).map(function(t){e.push(t)}),e},updateSelection:function(e){var t=!1;x.length===e.length&&(t=!0,Array.from(x).map(function(n){-1===e.indexOf(n)&&(t=!1)})),t||(x=e,Array.from(E).map(function(e){e.classList.remove(b.eltSelectedClass)}),Array.from(x).map(function(e){e.classList.add(b.eltSelectedClass)}),Array.from(k).map(function(e){e.onSelectionUpdate&&e.onSelectionUpdate(x)}))},removeElements:function(e){Array.from(e).map(function(e){var t=E.indexOf(e);-1!==t&&E.splice(t,1),t=x.indexOf(e),-1!==t&&x.splice(t,1),e.parentNode.removeChild(e)}),Array.from(k).map(function(e){e.onSelectionUpdate&&e.onSelectionUpdate(x)})},isMkaContainerFocused:function(e){if(e.id===b.focus)return!0;for(;e.parentNode;)if(e=e.parentNode,e.id===b.focus)return!0;return!1}};Array.from(k).map(function(e){e.init&&e.init(b,t)});var n=function(e,t){e.value[t]=function(n){var o=!1;Array.from(k).map(function(r){o||(o=r[e.name]&&r[e.name][t]&&r[e.name][t](n)||!1)})}},o=["onmousedown","onmousemove","onmouseup","onclick","ondblclick"],r=[{name:"windowEvents",value:window},{name:"documentEvents",value:document.body},{name:"mkaEvents",value:S}],i=["onkeydown","onkeypress","onkeyup"];Array.from(r).map(function(e){Array.from(o).map(function(t){n(e,t)})}),Array.from(i).map(function(e){n({name:"windowEvents",value:window},e)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={},l=(t.init=function(e,t){r=e,o=t,i()},t.windowEvents={onkeydown:function(e){var t=e.which;return!(37!=t&&38!=t&&39!=t&&40!=t||!document.getElementById("mkarcmenu"))&&(e.preventDefault(),!0)},onclick:function(e){return 1===e.which&&l()}},function(){return!!document.getElementById("mkarcmenu")&&(document.getElementById("mkarcmenu").remove(),!0)}),i=function(){o.getContainer().addEventListener("contextmenu",function(e){e.preventDefault(),l();var t=o.getSelectableElement(e.target);if(null!==t){o.elementIsSelected(t)||o.updateSelection([t]);var n=o.getSelection(),i=r.rightClick(n),a=document.createElement("ul");Array.from(i).map(function(e){var t=document.createElement("li");t.innerHTML=e.title,t.onclick=e.action,a.appendChild(t)});var s=document.createElement("div");s.setAttribute("id","mkarcmenu"),s.style.position="absolute",s.style.left=e.pageX+"px",s.style.top=e.pageY+"px",s.appendChild(a),o.getContainer().appendChild(s)}})}},function(e,t,n){"use strict";function o(e){e.addEventListener("dragover",function(e){this.classList.add("zone-hover"),e.preventDefault()}),e.addEventListener("dragleave",function(){this.classList.remove("zone-hover")}),e.addEventListener("drop",function(e){var t=r.getSelection();l.dropFunction([1,2]),r.removeElements(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.bindDropEvents=o;var r={},l={},i={dropableClass:".mka-dropzone"},a=(t.init=function(e,t){l=e,Object.keys(i).map(function(e){l[e]=l[e]||i[e]}),r=t;var n=r.getSelectablesElements(),a=document.querySelectorAll(l.dropableClass);Array.from(n).map(function(e){c(e)}),Array.from(a).map(function(e){return o(e)})},!1),s=!1,c=(t.onSelectionUpdate=function(e){Array.from(r.getSelectablesElements()).map(function(e){e.draggable=!1}),Array.from(e).map(function(e){e.draggable=!0})},t.mkaEvents={onmousedown:function(e){return s=e.target&&r.elementIsSelected(e.target),!1}},t.documentEvents={onmousemove:function(){return a=s}},t.windowEvents={onmouseup:function(){return s=!1,!!a&&(a=!1,!0)}},function(e){e.addEventListener("dragstart",function(e){var t=r.getSelection();Array.from(t).map(function(e){return e.classList.add("on-drag")});var n="",o=document.createElement("div"),l=t[0].scrollWidth;Array.from(t).map(function(e){n+=e.innerHTML}),o.innerHTML=n,o.id="wrapper-drag",o.style.width=l+"px",o.style.position="absolute",o.style.top="-10000px",o=u(o),document.body.appendChild(o),e.dataTransfer.setDragImage(o,0,0),e.dataTransfer.setData("text/plain","")}),e.addEventListener("dragend",function(e){var t=r.getSelection();document.getElementById("wrapper-drag").outerHTML="",Array.from(t).map(function(e){return e.classList.remove("on-drag")})})}),u=function(e){var t=e.children,n=t.length>15?1:2;e.style.opacity="1";for(var o=0;o<t.length;o++){var r=t[o];if(l.onDragItemClass?r.classList.add(l.onDragItemClass):(r.style.color="black",r.style.backgroundColor="white",r.style.border="1px solid grey",r.style.padding="5px",r.style.textAlign="center",r.style.width="100%"),r.style.position="absolute",r.style.top=o*n+"px",r.style.left=o*n+"px",o===t.length-1&&t.length>1){var i=document.createElement("span");i.innerHTML=t.length,i.style.height="25px",i.style.width="25px",i.style.lineHeight="25px",i.style.position="absolute",i.style.right="-10px",i.style.top="-5px",i.style.zIndex="25",i.style.borderRadius="15px",i.style.textAlign="center",l.onDragItemClass||(i.style.backgroundColor="red",i.style.color="white"),r.appendChild(i)}}return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={},l=null,i=(t.init=function(e,t){r=e,r.eltSelectingClass=r.eltSelectingClass||r.eltSelectedClass,o=t},{}),a=!1,s=!1,c=[];t.mkaEvents={onmousedown:function(e){if(1===e.which){if(e.shiftKey){var t=o.getSelectablesElements(),n=o.getSelection(),r=[],a=null;if(t.forEach(function(t){m(t,e.pageX,e.pageY,e.pageX,e.pageY)&&(a=t)}),null===l&&(l=t.indexOf(n[0])),n.length>0)for(var c=t.indexOf(a),u=0;u<t.length;u++)(u>=c&&u<=l||u<=c&&u>=l)&&r.push(t[u]);else r.push(a);o.updateSelection(r)}else s=!0,l=null,i.downX=e.pageX+0,i.downY=e.pageY+0,i.upX=e.pageX+0,i.upY=e.pageY+0,d();return!0}return!1},ondblclick:function(e){return a=!1,i.delete(),!1}},t.documentEvents={onmousemove:function(e){if(s){if(a=r.lasso&&1===e.which)return e.ctrlKey||i.isVisble()||(o.updateSelection([]),l=null),u(e),!0;f()}return!1}},t.windowEvents={onclick:function(e){if(1===e.which&&!a&&!e.shiftKey){var t=null;if(Array.from(o.getSelectablesElements()).map(function(n){m(n,e.pageX,e.pageY,e.pageX,e.pageY)&&(t=n)}),t){if(0!==o.getSelection().length&&e.ctrlKey){var n=o.getSelection(),r=n.indexOf(t);-1===r?n.push(t):n.splice(r,1),o.updateSelection(n)}else o.updateSelection([t])}else o.updateSelection([]),l=null;return!0}return f(),!1}};i={downX:null,downY:null,upX:null,upY:null,get:function(){var e=document.getElementById("selection-square");return e||(e=document.createElement("div"),e.id="selection-square",e.style.position="absolute",e.style.backgroundColor="rgba(255,0,0,0.5)",e.style.border="1px solid rgba(255,0,0,0.8)",e.style.display="none",o.getContainer().appendChild(e)),e},refresh:function(){var e=i.get();e.style.display="block",e.style.top=i.y1+"px",e.style.left=i.x1+"px",e.style.width=i.x2-i.x1+"px",e.style.height=i.y2-i.y1+"px"},delete:function(){i.get().style.display="none"},isVisble:function(){return"block"===i.get().style.display},isCrossingElt:function(e){return m(e,i.x1,i.y1,i.x2,i.y2)}};var u=function(e){i.upX=e.pageX+0,i.upY=e.pageY+0,d(),p(e.ctrlKey),i.refresh()},f=function(){i.delete(),s=!1,a&&(a=!1,Array.from(c).map(function(e){e.classList.remove(r.eltSelectingClass)}),o.updateSelection(c),c=[])},d=function(){i.x1=i.downX,i.x2=i.upX,i.y1=i.downY,i.y2=i.upY,i.downX>i.upX&&(i.x1=i.upX,i.x2=i.downX),i.downY>i.upY&&(i.y1=i.upY,i.y2=i.downY)},p=function(e){var t=o.getSelectablesElements();c=e?o.getSelection():[],Array.from(t).map(function(t){t.classList.remove(r.eltSelectingClass),!i.isCrossingElt(t)||e&&-1!==c.indexOf(t)||c.push(t)}),Array.from(c).map(function(e){e.classList.add(r.eltSelectingClass)})},m=function(e,t,n,o,r){var l=e.getBoundingClientRect(),i={x1:e.offsetLeft,x2:e.offsetLeft+l.width,y1:e.offsetTop,y2:e.offsetTop+l.height};return i.x2>t&&o>i.x1&&i.y2>n&&r>i.y1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(document.getElementById("mka"),void 0);t.active=function(e){document.onkeyup=function(t){"67"==t.which&&t.ctrlKey?o=Array.from(document.getElementsByClassName("mka-elt-selected")):"86"==t.which&&t.ctrlKey&&e.pasteFunction(o)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={};t.init=function(e,t){r=e,o=t},t.onSelectionUpdate=function(e){document.getElementById(r.count)&&(document.getElementById(r.count).innerHTML=e.length)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={},l=(t.init=function(e,t){r=e,o=t},null);t.windowEvents={onkeydown:function(e){var t=e.which;if(37==t||38==t||39==t||40==t){var n=o.getSelectablesElements(),r=e.shiftKey?o.getSelection():[],i=o.getLastSelectedInDom();switch(l=e.shiftKey&&(l||i)||null,e.which){case 37:case 38:if(!e.shiftKey){var a=n[n.indexOf(i)-1];r=a?[a]:[i]}break;case 39:case 40:if(!e.shiftKey){var s=n[n.indexOf(i)+1];r=s?[s]:[i]}break;default:return}e.preventDefault();var c=r[0].offsetLeft+r[0].offsetWidth/2-(window.scrollX+window.innerWidth/2),u=r[0].offsetTop+r[0].offsetHeight/2-(window.scrollY+window.innerHeight/2);return window.scrollBy(c,u),o.updateSelection(r),!0}return!1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={};t.init=function(e,t){r=e,o=t},t.windowEvents={onkeyup:function(e){var t=o.getSelection();return"46"==e.which&&t.length>0&&(r.deleteFunction(t),t.forEach(function(e){e.parentNode.removeChild(e)}),!0)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={},l=!1;t.init=function(e,t){r=e,o=t},t.windowEvents={onkeydown:function(e){if(e.ctrlKey){var t=e.which;if((65===t||97===t)&&l){var n=o.getSelectablesElements();o.updateSelection(n),e.preventDefault()}}},onmousedown:function(e){l=o.isMkaContainerFocused(e.target)}}}])});
//# sourceMappingURL=mka.min.js.map