!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mka",[],t):"object"==typeof exports?exports.mka=t():e.mka=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var r=n(1),i=o(r),l=n(2),a=o(l),c=n(3),s=o(c),u=n(4),f=o(u),d=n(5),p=o(d),m=n(6),y=o(m),g=n(7),v=o(g),h=n(8),w=o(h),b=n(9),S=o(b),x={eltsSelectable:[],eltSelectedClass:"mka-elt-selected",eltSelectingClass:"mka-elt-selecting",onDragItemClass:null,dragNdrop:!0,rightClick:!1,dbClick:!1,lasso:!0,selectAllShortcut:!0,copyPaste:!0,arrows:!0,deleteShortcut:!0,count:"",dropFunction:function(e){console.log(e),console.log("Default drop function, think to implement this function")},pasteFunction:function(e){console.log(e),console.log("Default past function, think to implement this function")},deleteFunction:function(e){console.log(e),console.log("Default delete function, think to implement this function")}};x.actions=[];var E=[],k=[],C=[];HTMLElement.prototype.mkaInit=function(e){var t=this;Object.keys(e).map(function(t){x[t]=e[t]}),E=[].slice.call(x.eltsSelectable),t.style.userSelect="none",x.dbClick&&C.push(i),x.rightClick&&C.push(a),x.dragNdrop&&C.push(s),x.selectAllShortcut&&C.push(S),x.copyPaste&&C.push(p),x.deleteShortcut&&C.push(w),x.arrows&&C.push(v),x.count&&C.push(y),C.push(f);var n={getContainer:function(){return t},elementIsSelected:function(e){if(e.classList&&e.classList.contains(x.eltSelectedClass))return!0;for(;e.parentNode;)if(e=e.parentNode,e.classList&&e.classList.contains(x.eltSelectedClass))return!0;return!1},getSelectableElement:function(e){if(e.classList&&-1!==E.indexOf(e))return e;for(;e.parentNode;)if(e=e.parentNode,e.classList&&-1!==E.indexOf(e))return e;return null},getSelectablesElements:function(){return E},getLastSelectedInDom:function(){var e=null;return Array.from(k).map(function(t){(!e||t.offsetTop>e.offsetTop||t.offsetTop===e.offsetTop&&t.offsetLeft>e.offsetLeft)&&(e=t)}),e},getSelection:function(){var e=[];return Array.from(k).map(function(t){e.push(t)}),e},updateSelection:function(e){var t=!1;k.length===e.length&&(t=!0,Array.from(k).map(function(n){-1===e.indexOf(n)&&(t=!1)})),t||(k=e,Array.from(E).map(function(e){e.classList.remove(x.eltSelectedClass)}),Array.from(k).map(function(e){e.classList.add(x.eltSelectedClass)}),Array.from(C).map(function(e){e.onSelectionUpdate&&e.onSelectionUpdate(k)}))},removeElements:function(e){Array.from(e).map(function(e){var t=E.indexOf(e);-1!==t&&E.splice(t,1),t=k.indexOf(e),-1!==t&&k.splice(t,1),e.parentNode.removeChild(e)}),Array.from(C).map(function(e){e.onSelectionUpdate&&e.onSelectionUpdate(k)})},isMkaContainerFocused:function(e){if(e===t)return!0;for(;e.parentNode;)if((e=e.parentNode)===t)return!0;return!1}};Array.from(C).map(function(e){e.init&&e.init(x,n)});var o=function(e,t){e.value[t]=function(n){var o=!1;Array.from(C).map(function(r){o||(o=r[e.name]&&r[e.name][t]&&r[e.name][t](n)||!1)})}},r=["onmousedown","onmousemove","onmouseup","onclick","ondblclick"],l=[{name:"windowEvents",value:window},{name:"documentEvents",value:document.body},{name:"mkaEvents",value:t}],c=["onkeydown","onkeypress","onkeyup"];Array.from(l).map(function(e){Array.from(r).map(function(t){o(e,t)})}),Array.from(c).map(function(e){o({name:"windowEvents",value:window},e)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={};t.init=function(e,t){r=e,o=t},t.mkaEvents={ondblclick:function(e){var t=o.getSelectableElement(e.target);return!(!t||"function"!=typeof r.dbClick)&&(o.updateSelection([t]),r.dbClick(t),!0)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={},i=(t.init=function(e,t){r=e,o=t,l()},t.windowEvents={onkeydown:function(e){var t=e.which;return!(37!=t&&38!=t&&39!=t&&40!=t||!document.getElementById("mkarcmenu"))&&(e.preventDefault(),!0)},onclick:function(e){return 1===e.which&&i()}},function(){return!!document.getElementById("mkarcmenu")&&(document.getElementById("mkarcmenu").remove(),!0)}),l=function(){o.getContainer().addEventListener("contextmenu",function(e){e.preventDefault(),i();var t=o.getSelectableElement(e.target);if(null!==t){o.elementIsSelected(t)||o.updateSelection([t]);var n=o.getSelection(),l=r.rightClick(n),a=document.createElement("ul");Array.from(l).map(function(e){var t=document.createElement("li");t.innerHTML=e.title,t.onclick=e.action,a.appendChild(t)});var c=document.createElement("div");c.setAttribute("id","mkarcmenu"),c.style.position="absolute",c.style.left=e.pageX+"px",c.style.top=e.pageY+"px",c.appendChild(a),o.getContainer().appendChild(c)}})}},function(e,t,n){"use strict";function o(e){e.addEventListener("dragover",function(e){this.classList.add("zone-hover"),e.preventDefault()}),e.addEventListener("dragleave",function(){this.classList.remove("zone-hover")}),e.addEventListener("drop",function(e){var t=r.getSelection();i.dropFunction([1,2]),r.removeElements(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.bindDropEvents=o;var r={},i={},l={dropableClass:".mka-dropzone"},a=(t.init=function(e,t){i=e,Object.keys(l).map(function(e){i[e]=i[e]||l[e]}),r=t;var n=r.getSelectablesElements(),a=document.querySelectorAll(i.dropableClass);Array.from(n).map(function(e){s(e)}),Array.from(a).map(function(e){return o(e)})},!1),c=!1,s=(t.onSelectionUpdate=function(e){Array.from(r.getSelectablesElements()).map(function(e){e.draggable=!1}),Array.from(e).map(function(e){e.draggable=!0})},t.mkaEvents={onmousedown:function(e){return c=e.target&&r.elementIsSelected(e.target),!1}},t.documentEvents={onmousemove:function(){return a=c}},function(e){e.addEventListener("dragstart",function(e){var t=r.getSelection();Array.from(t).map(function(e){return e.classList.add("on-drag")});var n="",o=document.createElement("div"),i=t[0].scrollWidth;Array.from(t).map(function(e){n+=e.innerHTML}),o.innerHTML=n,o.id="wrapper-drag",o.style.width=i+"px",o.style.position="absolute",o.style.top="-10000px",o=u(o),document.body.appendChild(o),e.dataTransfer.setDragImage(o,0,0),e.dataTransfer.setData("text/plain","")}),e.addEventListener("dragend",function(e){var t=r.getSelection();document.getElementById("wrapper-drag").outerHTML="",Array.from(t).map(function(e){return e.classList.remove("on-drag")})})}),u=function(e){var t=e.children,n=t.length>15?1:2;e.style.opacity="1";for(var o=0;o<t.length;o++){var r=t[o];if(i.onDragItemClass?r.classList.add(i.onDragItemClass):(r.style.color="black",r.style.backgroundColor="white",r.style.border="1px solid grey",r.style.padding="5px",r.style.textAlign="center",r.style.width="100%"),r.style.position="absolute",r.style.top=o*n+"px",r.style.left=o*n+"px",o===t.length-1&&t.length>1){var l=document.createElement("span");l.innerHTML=t.length,l.style.height="25px",l.style.width="25px",l.style.lineHeight="25px",l.style.position="absolute",l.style.right="-10px",l.style.top="-5px",l.style.zIndex="25",l.style.borderRadius="15px",l.style.textAlign="center",i.onDragItemClass||(l.style.backgroundColor="red",l.style.color="white"),r.appendChild(l)}}return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={},i=null,l=(t.init=function(e,t){r=e,o=t},{}),a=!1,c=!1,s=[];t.mkaEvents={onmousedown:function(e){if(1===e.which){if(e.shiftKey){var t=o.getSelectablesElements(),n=o.getSelection(),r=[],a=o.getSelectableElement(e.target);if(a){if(i=i||t.indexOf(n[0]),n.length>0){var s=t.indexOf(a),u=Math.min(i,s),f=Math.max(i,s);e.ctrlKey&&Array.from(n).map(function(e){var n=t.indexOf(e);n<u&&(u=n),n>f&&(f=n)});for(var d=u;d<=f;d++)r.push(t[d])}else r.push(a);o.updateSelection(r)}}else i=null,l.downX=e.pageX+0,l.downY=e.pageY+0,l.upX=e.pageX+0,l.upY=e.pageY+0,c=!0,m();return!0}return!1},ondblclick:function(){return f(),!1}},t.documentEvents={onmousemove:function(e){if(c){if(a=r.lasso&&1===e.which)return e.ctrlKey||l.isVisble()||(o.updateSelection([]),i=null),u(e),!0;f()}return!1}},t.windowEvents={onclick:function(){return f(),!1},onmousedown:function(e){if(p(),1===e.which&&!e.shiftKey){var t=o.getSelectableElement(e.target);if(t){var n=o.getSelection(),i=n.indexOf(t),l=[t];e.ctrlKey&&(l=n,-1!==i?l.splice(i,1):l.push(t)),-1!==i?Array.from(l).map(function(e){s.push(e),e.classList.add(r.eltSelectingClass)}):o.updateSelection(l)}else e.ctrlKey||o.updateSelection([])}},onmouseup:function(e){1===e.which&&d()}};l={downX:null,downY:null,upX:null,upY:null,get:function(){var e=document.getElementById("selection-square");return e||(e=document.createElement("div"),e.id="selection-square",e.style.position="absolute",e.style.backgroundColor="rgba(255,0,0,0.5)",e.style.border="1px solid rgba(255,0,0,0.8)",e.style.display="none",o.getContainer().appendChild(e)),e},refresh:function(){var e=l.get();e.style.display="block",e.style.top=l.y1+"px",e.style.left=l.x1+"px",e.style.width=l.x2-l.x1+"px",e.style.height=l.y2-l.y1+"px"},remove:function(){l.get().style.display="none"},isVisble:function(){return"block"===l.get().style.display},isCrossingElt:function(e){return g(e,l.x1,l.y1,l.x2,l.y2)}};var u=function(e){l.upX=e.pageX+0,l.upY=e.pageY+0,m(),y(e.ctrlKey),l.refresh()},f=function(){l.remove(),c=!1,a&&(a=!1,d())},d=function(){s.length&&(o.updateSelection(s),p())},p=function(){Array.from(s).map(function(e){e.classList.remove(r.eltSelectingClass)}),s=[]},m=function(){l.x1=l.downX,l.x2=l.upX,l.y1=l.downY,l.y2=l.upY,l.downX>l.upX&&(l.x1=l.upX,l.x2=l.downX),l.downY>l.upY&&(l.y1=l.upY,l.y2=l.downY)},y=function(e){var t=o.getSelectablesElements();s=e?o.getSelection():[],Array.from(t).map(function(t){t.classList.remove(r.eltSelectingClass),!l.isCrossingElt(t)||e&&-1!==s.indexOf(t)||(s.push(t),t.classList.add(r.eltSelectingClass))})},g=function(e,t,n,o,r){var i=e.getBoundingClientRect(),l={x1:e.offsetLeft,x2:e.offsetLeft+i.width,y1:e.offsetTop,y2:e.offsetTop+i.height};return l.x2>t&&o>l.x1&&l.y2>n&&r>l.y1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={},i=void 0;t.init=function(e,t){r=e,o=t},t.windowEvents={onkeyup:function(e){"67"==e.which&&e.ctrlKey?i=o.getSelection():"86"==e.which&&e.ctrlKey&&r.pasteFunction(i)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={};t.init=function(e,t){r=e,o=t},t.onSelectionUpdate=function(e){document.getElementById(r.count)&&(document.getElementById(r.count).innerHTML=e.length)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={},i=(t.init=function(e,t){r=e,o=t},null);t.windowEvents={onkeydown:function(e){var t=e.which;if(37==t||38==t||39==t||40==t){var n=o.getSelectablesElements(),r=e.shiftKey?o.getSelection():[],l=o.getLastSelectedInDom();switch(i=e.shiftKey&&(i||l)||null,e.which){case 37:case 38:if(!e.shiftKey){var a=n[n.indexOf(l)-1];r=a?[a]:[l]}break;case 39:case 40:if(!e.shiftKey){var c=n[n.indexOf(l)+1];r=c?[c]:[l]}break;default:return}if(e.preventDefault(),r[0]){var s=r[0].offsetLeft+r[0].offsetWidth/2-(window.scrollX+window.innerWidth/2),u=r[0].offsetTop+r[0].offsetHeight/2-(window.scrollY+window.innerHeight/2);window.scrollBy(s,u),o.updateSelection(r)}return!0}return!1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={};t.init=function(e,t){r=e,o=t},t.windowEvents={onkeyup:function(e){var t=o.getSelection();return"46"==e.which&&t.length>0&&(r.deleteFunction(t),t.forEach(function(e){e.parentNode.removeChild(e)}),!0)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={},r={},i=!1;t.init=function(e,t){r=e,o=t},t.windowEvents={onkeydown:function(e){if(e.ctrlKey){var t=e.which;if((65===t||97===t)&&i){var n=o.getSelectablesElements();o.updateSelection(n),e.preventDefault()}return!0}return!1},onmousedown:function(e){i=o.isMkaContainerFocused(e.target)}}}])});
//# sourceMappingURL=mka.min.js.map