!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("mka",[],t):"object"==typeof exports?exports.mka=t():e.mka=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var r=n(1),s=o(r),a=n(2),i=o(a),c=n(3),l=o(c),u=n(4),f=o(u),d=n(5),p=o(d),m=n(6),y=o(m),g=n(7),h=o(g),v=n(8),P=o(v),k=n(9),w=o(k),b={eltsSelectable:"",eltSelectedClass:"mka-elt-selected",eltSelectingClass:"mka-elt-selecting",onDragItemClass:null,dragNdrop:!1,droppableElements:"",rightClick:!1,dbClick:!1,lasso:!0,selectAllShortcut:!0,copyPaste:!0,arrows:!0,deleteShortcut:!1,count:"",pasteFunction:function(e){console.log(e),console.log("Default past function, think to implement this function")}},E=function(e,t,n){var o=e.mkaParams.configs,r=e.mkaParams.components,s=e.mkaParams.selectables,a=!1;if(e.mkaParams.selection.length===t.length&&(a=!0,e.mkaParams.selection.forEach(function(e){-1===t.indexOf(e)&&(a=!1)})),!a){e.mkaParams.selection=t,s.forEach(function(e){e.classList.remove(o.eltSelectedClass)}),e.mkaParams.selection.forEach(function(e){e.classList.add(o.eltSelectedClass)});var i={selection:e.mkaParams.selection,selectables:e.mkaParams.selectables,configs:e.mkaParams.configs,parentFunctions:L(e),actionId:n};r.forEach(function(e){e.onSelectionUpdate&&e.onSelectionUpdate(i)})}},S=function(e){var t={};return Object.keys(b).forEach(function(n){t[n]=void 0!==e[n]?e[n]:b[n]}),t},x=function(e){var t=e.mkaParams.configs;e.mkaParams.components=[],t.dbClick&&e.mkaParams.components.push(s),t.rightClick&&e.mkaParams.components.push(i),t.dragNdrop&&e.mkaParams.components.push(l),t.selectAllShortcut&&e.mkaParams.components.push(w),t.copyPaste&&e.mkaParams.components.push(p),t.deleteShortcut&&e.mkaParams.components.push(P),t.arrows&&e.mkaParams.components.push(h),t.count&&e.mkaParams.components.push(y),e.mkaParams.components.push(f)},L=function(e){var t=e.mkaParams.configs,n=e.mkaParams.components;return e.mkaParams.customProperties=e.mkaParams.customProperties||{},{getContainer:function(){return e},setProperty:function(t,n){e.mkaParams.customProperties[t]=n},getProperty:function(t){return e.mkaParams.customProperties[t]},elementIsSelected:function(e){if(e.classList&&e.classList.contains(t.eltSelectedClass))return!0;for(;e.parentNode;)if(e=e.parentNode,e.classList&&e.classList.contains(t.eltSelectedClass))return!0;return!1},getSelectableElement:function(t){var n=e.mkaParams.selectables;if(t.classList&&-1!==n.indexOf(t))return t;for(;t.parentNode;)if(t=t.parentNode,t.classList&&-1!==n.indexOf(t))return t;return null},getSelectablesElements:function(){return e.mkaParams.selectables},getLastSelectedInDom:function(){var t=null;return e.mkaParams.selection.forEach(function(e){(!t||e.offsetTop>t.offsetTop||e.offsetTop===t.offsetTop&&e.offsetLeft>t.offsetLeft)&&(t=e)}),t},getSelection:function(){var t=[];return e.mkaParams.selection.forEach(function(e){t.push(e)}),t},updateSelection:function(t,n){E(e,t,n)},removeElements:function(t){t.forEach(function(t){var n=e.mkaParams.selectables.indexOf(t);-1!==n&&e.mkaParams.selectables.splice(n,1),n=e.mkaParams.selection.indexOf(t),-1!==n&&e.mkaParams.selection.splice(n,1),t.parentNode.removeChild(t)}),n.forEach(function(t){t.onSelectionUpdate&&t.onSelectionUpdate(e.mkaParams.selection,e.mkaParams.selectables)})},isMkaContainerFocused:function(t){if(t===e)return!0;for(;t.parentNode;)if((t=t.parentNode)===e)return!0;return!1}}},C=function(e){var t=e.mkaParams.configs;e.mkaParams.components.forEach(function(n){n.init&&n.init(t,L(e))})},M=function(e){var t=L(e),n=e.mkaParams.components,o=function(o,r){var s=o.value[r];o.value[r]=function(a){var i=!1;return s&&"function"==typeof s&&(i=s(a).forceStop),n.forEach(function(n){i||(i=n[o.name]&&n[o.name][r]&&n[o.name][r](a,t,e.mkaParams.configs)||!1)}),{forceStop:i}}},r=["onmousedown","onmousemove","onmouseup","onclick","ondblclick"],s=[{name:"windowEvents",value:window},{name:"documentEvents",value:document.body},{name:"mkaEvents",value:e}],a=["onkeydown","onkeypress","onkeyup"];s.forEach(function(e){r.forEach(function(t){o(e,t)})}),a.forEach(function(e){o({name:"windowEvents",value:window},e)})},T=function(e){e.mkaParams.components.forEach(function(t){t.refresh&&t.refresh(e.mkaParams.selectables,e.mkaParams.configs)})},B=function(e,t){e.mkaParams.selectables&&e.mkaParams.selectables.forEach(function(e){e.mkaSelectable=!1}),t.forEach(function(e){e.mkaSelectable=!0}),e.mkaParams.selectables=t},O=function(e){var t=[].slice.call(e.querySelectorAll(e.mkaParams.configs.eltsSelectable)),n=[];e.mkaParams.selection.forEach(function(e){-1!==t.indexOf(e)&&n.push(e)}),E(e,n),B(e,t),T(e)},I=function(e){var t=function(t){if(t.mkaSelectable)return!0;var n=t.parentNode;if(n)for(var o=n.querySelectorAll(e.mkaParams.configs.eltsSelectable),r=0;r<o.length;r++)if(o.item(r)===t)return!0;return!!(t.querySelectorAll&&t.querySelectorAll(e.mkaParams.configs.eltsSelectable).length>0)};if("undefined"!=typeof MutationObserver){new MutationObserver(function(n){var o=!1;n.forEach(function(e){if(!o){if(e.addedNodes)for(var n=0;n<e.addedNodes.length;n++)o=t(e.addedNodes.item(n));if(e.removedNodes)for(var r=0;r<e.removedNodes.length;r++)o=t(e.removedNodes.item(r))}}),o&&O(e)}).observe(e,{childList:!0,subtree:!0})}else e.addEventListener("DOMNodeRemoved",function(n){t(n.target)&&setTimeout(function(){O(e)},0)}),e.addEventListener("DOMNodeInserted",function(n){t(n.target)&&setTimeout(function(){O(e)},0)})};HTMLElement.prototype.mkaInit=function(e){var t=this;t.style.userSelect="none",t.style["-moz-user-select"]="none",t.style["-webkit-user-select"]="none",t.style["-ms-user-select"]="none";var n=S(e),o=[].slice.call(t.querySelectorAll(n.eltsSelectable));t.mkaParams={configs:n,selection:[]},B(t,o),x(t),C(t),M(t),I(t)},HTMLElement.prototype.mkaRefresh=function(){var e=this;if(!e.mkaParams||!e.mkaParams.configs)return console.log("No MKA found on this element, call mkaInit first"),!1;O(e)};var _=function(e,t){for(var n=e[t];e.offsetParent!==document.body;)e=e.offsetParent,n+=e[t];return n};HTMLElement.prototype.offsetBodyLeft=function(){return _(this,"offsetLeft")},HTMLElement.prototype.offsetBodyTop=function(){return _(this,"offsetTop")},HTMLElement.prototype.offsetBodyRight=function(){return _(this,"offsetRight")},HTMLElement.prototype.offsetBodyBottom=function(){return _(this,"offsetBottom")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.mkaEvents={ondblclick:function(e,t,n){var o=t.getSelectableElement(e.target);return!(!o||"function"!=typeof n.dbClick)&&(t.updateSelection([o]),n.dbClick(o),!0)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(t.init=function(e,t){s(e,t)},t.windowEvents={onkeydown:function(e){var t=e.which;return!(37!=t&&38!=t&&39!=t&&40!=t||!document.getElementById("mkarcmenu"))&&(e.preventDefault(),!0)},onclick:function(e){return 1===e.which&&o()}},function(){var e=document.getElementById("mkarcmenu");return!(!e||"none"===e.style.display)&&(e.style.display="none",!0)}),r=function(){var e=document.getElementById("mkarcmenu");return e||(e=document.createElement("div"),e.setAttribute("id","mkarcmenu"),document.body.appendChild(e)),e},s=function(e,t){t.getContainer().addEventListener("contextmenu",function(n){n.preventDefault(),o();var s=t.getSelectableElement(n.target);null!==s?t.elementIsSelected(s)||t.updateSelection([s]):t.updateSelection([]);var a=t.getSelection(),i=r(),c=e.rightClick(a);c instanceof HTMLElement?(i.innerHTML="",i.appendChild(c)):i.innerHTML=c,i.style.position="absolute",i.style.left=n.pageX+"px",i.style.top=n.pageY+"px",i.style.display="block"})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(t.init=function(e,t){(t.setProperty("isDragging",!1),t.setProperty("draggableTarget",!1),t.getSelectablesElements().forEach(function(n){o(n,t,e)}),e.droppableElements)&&[].slice.call(document.querySelectorAll(e.droppableElements)).forEach(function(n){return r(n,t,e)})},t.onSelectionUpdate=function(e){e.selectables.forEach(function(e){e.draggable=!1}),e.selection.forEach(function(e){e.draggable=!0})},t.mkaEvents={onmousedown:function(e,t){return t.setProperty("draggableTarget",e.target&&t.elementIsSelected(e.target)),!1}},t.documentEvents={onmousemove:function(e,t){var n=t.getProperty("draggableTarget");return t.setProperty("isDragging",n),n}},t.windowEvents={onmouseup:function(e,t){return t.setProperty("isDragging",!1),t.setProperty("draggableTarget",!1),!1}},function(e,t,n){e.addEventListener("dragstart",function(e){var o=t.getSelection();o.forEach(function(e){return e.classList.add("on-drag")});var r="",a=document.createElement("div"),i=o[0].scrollWidth;o.forEach(function(e){r+="<div> "+e.innerHTML+" </div>"}),a.innerHTML=r,a.id="wrapper-drag",a.style.width=i+"px",a.style.position="absolute",a.style.top="-10000px",a=s(a,n),document.body.appendChild(a),e.dataTransfer.setDragImage(a,0,0),e.dataTransfer.setData("text/plain","")}),e.addEventListener("dragend",function(e){var n=t.getSelection();document.getElementById("wrapper-drag").outerHTML="",n.forEach(function(e){return e.classList.remove("on-drag")})})}),r=function(e,t,n){e.addEventListener("dragover",function(e){this.classList.add("zone-hover"),e.preventDefault()}),e.addEventListener("dragleave",function(){this.classList.remove("zone-hover")}),e.addEventListener("drop",function(o){var r=t.getSelection();"function"==typeof n.dragNdrop&&n.dragNdrop(r,e)})},s=function(e,t){var n=e.children,o=n.length>15?1:2;e.style.opacity="1";for(var r=0;r<n.length;r++){var s=n[r];if(t.onDragItemClass?s.classList.add(t.onDragItemClass):(s.style.color="black",s.style.backgroundColor="white",s.style.border="1px solid grey",s.style.padding="5px",s.style.textAlign="center",s.style.width="100%"),s.style.position="absolute",s.style.top=r*o+"px",s.style.left=r*o+"px",r===n.length-1&&n.length>1){var a=document.createElement("span");a.innerHTML=n.length,a.style.height="25px",a.style.width="25px",a.style.lineHeight="25px",a.style.position="absolute",a.style.right="-10px",a.style.top="-5px",a.style.zIndex="25",a.style.borderRadius="15px",a.style.textAlign="center",t.onDragItemClass||(a.style.backgroundColor="red",a.style.color="white"),s.appendChild(a)}}return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(t.init=function(e,t){t.setProperty("focusedElementIndex",null),t.setProperty("selecting",[]);var n="selection-square-"+Math.floor(1e5*Math.random()),o={downX:null,downY:null,upX:null,upY:null,get:function(){var e=document.getElementById(n);return e||(e=document.createElement("div"),e.id=n,e.style.position="absolute",e.style.backgroundColor="rgba(255,0,0,0.5)",e.style.border="1px solid rgba(255,0,0,0.8)",e.style.display="none",t.getContainer().appendChild(e)),e},refresh:function(){var e=o.get();e.style.display="block",e.style.top=o.y1+"px",e.style.left=o.x1+"px",e.style.width=o.x2-o.x1+"px",e.style.height=o.y2-o.y1+"px"},remove:function(){o.get().style.display="none"},isVisble:function(){return"block"===o.get().style.display},isCrossingElt:function(e){return l(e,o.x1,o.y1,o.x2,o.y2)}};t.setProperty("square",o)},t.mkaEvents={onmousedown:function(e,t){if(1===e.which){if(e.shiftKey){var n=t.getSelectablesElements(),o=t.getSelection(),r=[],s=t.getSelectableElement(e.target);if(s){var a=t.getProperty("focusedElementIndex")||n.indexOf(o[0]);if(t.setProperty("focusedElementIndex",a),o.length>0){var c=n.indexOf(s),l=Math.min(a,c),u=Math.max(a,c);e.ctrlKey&&o.forEach(function(e){var t=n.indexOf(e);t<l&&(l=t),t>u&&(u=t)});for(var f=l;f<=u;f++)r.push(n[f])}else r.push(s);t.updateSelection(r)}}else{t.setProperty("focusedElementIndex",null);var d=t.getProperty("square");d.downX=e.pageX+0,d.downY=e.pageY+0,d.upX=e.pageX+0,d.upY=e.pageY+0,t.setProperty("square",d),t.setProperty("canStartLasso",!0),i(d)}return!0}return!1},ondblclick:function(e,t,n){return r(t,n),!1}},t.documentEvents={onmousemove:function(e,t,n){if(t.getProperty("canStartLasso")){var s=n.lasso&&1===e.which;if(t.setProperty("isInLasso",s),s)return e.ctrlKey||t.getProperty("square").isVisble()||(t.updateSelection([]),t.setProperty("focusedElementIndex",null)),o(e,t,n),!0;r(t,n)}return!1}},t.windowEvents={onmousedown:function(e,t,n){if(a(t,n),1===e.which&&!e.shiftKey){var o=t.getSelectableElement(e.target);if(o){var r=t.getSelection(),s=r.indexOf(o),i=[o];e.ctrlKey&&(i=r,-1!==s?i.splice(s,1):i.push(o));var c=[];i.forEach(function(e){c.push(e),e.classList.add(n.eltSelectingClass)}),t.setProperty("selecting",c)}else e.ctrlKey||t.updateSelection([])}return!1},onmouseup:function(e,t,n){return 1===e.which&&(s(t,n),r(t,n)),!1}},function(e,t,n){var o=t.getProperty("square");o.upX=e.pageX+0,o.upY=e.pageY+0,t.setProperty("square",o),i(o),c(e.ctrlKey,o,t,n),o.refresh()}),r=function(e,t){e.getProperty("square").remove(),e.setProperty("canStartLasso",!1),e.getProperty("isInLasso")&&(e.setProperty("isInLasso",!1),s(e,t))},s=function(e,t){e.getProperty("selecting").length&&(e.updateSelection(e.getProperty("selecting")),a(e,t))},a=function(e,t){e.getProperty("selecting").forEach(function(e){e.classList.remove(t.eltSelectingClass)}),e.setProperty("selecting",[])},i=function(e){e.x1=e.downX,e.x2=e.upX,e.y1=e.downY,e.y2=e.upY,e.downX>e.upX&&(e.x1=e.upX,e.x2=e.downX),e.downY>e.upY&&(e.y1=e.upY,e.y2=e.downY)},c=function(e,t,n,o){var r=n.getSelectablesElements(),s=e?n.getSelection():[];r.forEach(function(n){n.classList.remove(o.eltSelectingClass),!t.isCrossingElt(n)||e&&-1!==s.indexOf(n)||(s.push(n),n.classList.add(o.eltSelectingClass))}),n.setProperty("selecting",s)},l=function(e,t,n,o,r){var s=e.getBoundingClientRect(),a={x1:e.offsetBodyLeft(),x2:e.offsetBodyLeft()+s.width,y1:e.offsetBodyTop(),y2:e.offsetBodyTop()+s.height};return a.x2>t&&o>a.x1&&a.y2>n&&r>a.y1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.init=function(e,t){t.setProperty("copyElts",[])},t.windowEvents={onkeyup:function(e,t,n){"67"==e.which&&e.ctrlKey?t.setProperty("copyElts",t.getSelection()):"86"==e.which&&e.ctrlKey&&n.pasteFunction(t.getProperty("copyElts"))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.onSelectionUpdate=function(e){e.selection&&e.configs&&document.getElementById(e.configs.count)&&(document.getElementById(e.configs.count).innerHTML=e.selection.length)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(t.init=function(e,t){t.setProperty("arrows.currentFocus",null),t.setProperty("arrows.isContainerFocused",!1)},t.onSelectionUpdate=function(e){var t=e.selection,n=e.parentFunctions;t&&n&&(t.length>0?(n.setProperty("arrows.lastSelected",t[t.length-1]),1===t.length?n.setProperty("arrows.currentFocus",t[0]):"arrows.shift"!==e.actionId&&n.setProperty("arrows.currentFocus",null)):(n.setProperty("arrows.lastSelected",null),n.setProperty("arrows.currentFocus",null)))},t.windowEvents={onmousedown:function(e,t){return t.setProperty("arrows.isContainerFocused",t.isMkaContainerFocused(e.target)),!1},onkeydown:function(e,t){var n=e.which;if(37==n||38==n||39==n||40==n){var r=t.getProperty("arrows.lastSelected");if(r){e.preventDefault();var s=function(e){var t=e.offsetBodyLeft()+e.offsetWidth/2-(window.scrollX+window.innerWidth/2),n=e.offsetBodyTop()+e.offsetHeight/2-(window.scrollY+window.innerHeight/2);window.scrollBy(t,n)};s(r);var a=o(r,n,t);if(a){var i=[];if(e.shiftKey&&t.getProperty("arrows.currentFocus")){i=t.getSelection();var c=i.indexOf(a);if(37==n||39==n)-1===c?i.push(a):i.splice(i.length-1,1);else{for(var l=[],u=r;u&&u!==a;)(u=o(u,38==n?37:39,t))&&l.push(u);-1===c?i=i.concat(l):i.splice(c+1)}t.updateSelection(i,"arrows.shift")}else i=[a],t.updateSelection(i);return s(a),!0}}else if(t.getProperty("arrows.isContainerFocused")){var f=t.getSelectablesElements()[0];f&&t.updateSelection([f])}}return!1}},function(e,t,n){var o=e.getBoundingClientRect(),r=0,s=0,a=0,i=0;switch(t){case 37:r=e.offsetBodyLeft(),s=e.offsetBodyTop()+o.height/2,a=-10;break;case 38:r=e.offsetBodyLeft()+o.width/2,s=e.offsetBodyTop(),i=-10;break;case 39:r=e.offsetBodyLeft()+o.width,s=e.offsetBodyTop()+o.height/2,a=10;break;case 40:r=e.offsetBodyLeft()+o.width/2,s=e.offsetBodyTop()+o.height,i=10}r+=a,s=s+i-window.scrollY;var c=!1,l=n.getContainer(),u=function(n){var r=n.offsetBodyTop()+n.getBoundingClientRect().height/2;return 37===t?r>=e.offsetBodyTop():39===t?r<=e.offsetBodyTop()+o.height:void 0};return function f(d){c=c||d;var p=document.elementFromPoint(r,s),m=n.getSelectableElement(p);return!m||c&&u(m)?n.isMkaContainerFocused(p)?(r+=a,s+=i,f()):38===t||40===t||d?null:(37===t?(s=c?s-10:e.offsetBodyTop()-10-window.scrollY,r=l.offsetBodyLeft()+l.getBoundingClientRect().width-10):(s=c?s+10:e.offsetBodyTop()+o.height+10-window.scrollY,r=l.offsetBodyLeft()+10),f(!0)):m}()})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.windowEvents={onkeyup:function(e,t,n){var o=t.getSelection();return"46"==e.which&&o.length>0&&"function"==typeof n.deleteShortcut&&(n.deleteShortcut(o),!0)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.init=function(e,t){t.setProperty("isMkaContainerFocused",!1)},t.windowEvents={onkeydown:function(e,t){if(e.ctrlKey){var n=e.which;if((65===n||97===n)&&t.getProperty("isMkaContainerFocused")){var o=t.getSelectablesElements();return t.updateSelection(o),e.preventDefault(),!0}}return!1},onmousedown:function(e,t){return t.setProperty("isMkaContainerFocused",t.isMkaContainerFocused(e.target)),!1}}}])});
//# sourceMappingURL=mka.min.js.map